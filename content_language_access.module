<?php

/**
 * @file
 * This module provides access checking of the current language of the site
 * with the language of the content (language neutral are not considered).
 */

/**
 * Implements hook_node_access().
 *
 * @global object $language
 *
 * @param object $node
 *   The node object (or node array) on which the operation is to be performed,
 *   or node type (e.g. 'forum') for "create" operation.
 * @param string $op
 *   The operation to be performed on the node. Possible values are:
 *   - "view"
 *   - "update"
 *   - "delete"
 *   - "create"
 * @param object $account
 *   Optional, a user object representing the user for whom the operation is to
 *   be performed. Determines access for a user other than the current user.
 *
 * @return string
 *   NODE_ACCESS_ALLOW: if the operation is to be allowed.
 *   NODE_ACCESS_DENY: if the operation is to be denied.
 *   NODE_ACCESS_IGNORE: to not affect this operation at all.
 */
function content_language_access_node_access($node, $op, $account) {
  global $language;

  // Only checks for view permission.
  if (is_object($node) && $op == 'view') {
    if ($node->language) {
      // Verifies if the current language is the same of the content.
      if ($node->language != $language->language) {
        return NODE_ACCESS_DENY;
      }
    }
  }

  return NODE_ACCESS_IGNORE;
}
